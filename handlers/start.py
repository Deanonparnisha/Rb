from aiogram import Router, types, F
from aiogram.filters import Command
from database import Database
from keyboards import get_main_kb_no_family, get_main_kb_with_family

router = Router()
db = Database('space.db')


@router.message(Command("start"))
async def cmd_start(message: types.Message):
    user_id = message.from_user.id
    username = message.from_user.username or "SpaceTraveller"

    db.add_user(user_id, username)
    family_id = db.get_user_family(user_id)

    if family_id:
        info = db.get_family_info(family_id)
        # info: 0=name, ..., 5=planet

        text = (
            f"ğŸŸ¢ **Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ Ğ†Ğ”Ğ•ĞĞ¢Ğ˜Ğ¤Ğ†ĞšĞĞ¦Ğ†Ğ‡: Ğ£Ğ¡ĞŸĞ†Ğ¥**\n"
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
            f"ğŸ‘¤ ĞŸÑ–Ğ»Ğ¾Ñ‚: **{username}**\n"
            f"ğŸš€ Ğ•ĞºÑ–Ğ¿Ğ°Ğ¶: **{info[0]}**\n"
            f"ğŸ“ ĞŸĞ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ° Ğ±Ğ°Ğ·Ğ°: **{info[5]}**\n"
            f"â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n"
            f"ĞÑ‡Ñ–ĞºÑƒÑ Ğ²Ğ°ÑˆĞ¸Ñ… Ğ²ĞºĞ°Ğ·Ñ–Ğ²Ğ¾Ğº Ñ‡ĞµÑ€ĞµĞ· Ğ±Ğ¾Ñ€Ñ‚Ğ¾Ğ²Ğ¸Ğ¹ ĞºĞ¾Ğ¼Ğ¿'ÑÑ‚ĞµÑ€ ğŸ‘‡"
        )
        await message.answer(text, parse_mode="Markdown", reply_markup=get_main_kb_with_family())
    else:
        text = (
            f"ğŸŒŒ **Ğ›ĞĞ¡ĞšĞĞ’Ğ ĞŸĞ ĞĞ¡Ğ˜ĞœĞ Ğ”Ğ ROCKET LAB** ğŸŒŒ\n\n"
            f"Ğ’Ğ¸ â€” Ğ½Ğ¾Ğ²Ğ¸Ğ¹ ÑƒÑ‡Ğ°ÑĞ½Ğ¸Ğº ĞºĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ğ¾Ñ— Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¸. Ğ’Ğ°ÑˆĞ° Ğ¼ĞµÑ‚Ğ° â€” Ğ¿Ñ–Ğ´ĞºĞ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¡Ğ¾Ğ½ÑÑ‡Ğ½Ñƒ ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ, Ğ²Ñ–Ğ´ Ğ—ĞµĞ¼Ğ»Ñ– Ğ´Ğ¾ Ğ®Ğ¿Ñ–Ñ‚ĞµÑ€Ğ°.\n\n"
            f"âš ï¸ **Ğ’ĞĞ–Ğ›Ğ˜Ğ’Ğ:** ĞĞ´Ğ¸Ğ½Ğ°ĞºĞ°Ğ¼ Ñ‚ÑƒÑ‚ Ğ½Ğµ Ğ²Ğ¸Ğ¶Ğ¸Ñ‚Ğ¸. Ğ’Ğ°Ğ¼ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ğ¾:\n"
            f"1ï¸âƒ£ Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ²Ğ»Ğ°ÑĞ½Ñƒ ĞºĞ¾ÑĞ¼Ñ–Ñ‡Ğ½Ñƒ ÑÑ–Ğ¼'Ñ (ĞµĞºÑ–Ğ¿Ğ°Ğ¶).\n"
            f"2ï¸âƒ£ ĞĞ±Ğ¾ Ğ¿Ñ€Ğ¸Ñ”Ğ´Ğ½Ğ°Ñ‚Ğ¸ÑÑ Ğ´Ğ¾ Ğ´Ñ€ÑƒĞ·Ñ–Ğ² Ğ·Ğ° ĞºĞ¾Ğ´Ğ¾Ğ¼.\n\n"
            f"ğŸ‘‡ **ĞĞ±ĞµÑ€Ñ–Ñ‚ÑŒ Ğ´Ñ–Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ:**"
        )
        await message.answer(text, parse_mode="Markdown", reply_markup=get_main_kb_no_family())


@router.message(Command("help"))
@router.message(F.text == "â„¹ï¸ Ğ”Ğ¾Ğ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°")
async def cmd_help(message: types.Message):
    text = (
        "ğŸ“˜ **Ğ‘ĞĞ Ğ¢ĞĞ’Ğ˜Ğ™ Ğ–Ğ£Ğ ĞĞĞ›: Ğ†ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¦Ğ†Ğ¯**\n"
        "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n"
        "ğŸš€ **ĞœĞ†Ğ¡Ğ†Ğ‡**\n"
        "Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞ¹Ñ‚Ğµ Ñ€Ğ°ĞºĞµÑ‚Ğ¸ Ğ·Ğ° Ñ€ĞµÑÑƒÑ€ÑĞ°Ğ¼Ğ¸. Ğ£Ğ²Ğ°Ğ³Ğ° Ğ½Ğ° **Ğ Ğ¸Ğ·Ğ¸Ğº** (â˜ ï¸)! Ğ¯ĞºÑ‰Ğ¾ Ñ€Ğ¸Ğ·Ğ¸Ğº Ğ²Ğ¸ÑĞ¾ĞºĞ¸Ğ¹, Ğ½Ğ° Ğ²Ğ°Ñ Ğ¼Ğ¾Ğ¶ÑƒÑ‚ÑŒ Ğ½Ğ°Ğ¿Ğ°ÑÑ‚Ğ¸ Ğ¿Ñ–Ñ€Ğ°Ñ‚Ğ¸. ĞšĞ°Ñ‡Ğ°Ğ¹Ñ‚Ğµ **ĞšĞ¾Ñ€Ğ¿ÑƒÑ**, Ñ‰Ğ¾Ğ± Ğ·Ğ°Ñ…Ğ¸ÑÑ‚Ğ¸Ñ‚Ğ¸ÑÑŒ.\n\n"
        "ğŸ­ **Ğ†ĞĞ¤Ğ ĞĞ¡Ğ¢Ğ Ğ£ĞšĞ¢Ğ£Ğ Ğ**\n"
        "Ğ‘ÑƒĞ´ÑƒĞ¹Ñ‚Ğµ ÑˆĞ°Ñ…Ñ‚Ğ¸ Ğ´Ğ»Ñ Ğ¿Ğ°ÑĞ¸Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ğ¸Ğ´Ğ¾Ğ±ÑƒÑ‚ĞºÑƒ. Ğ ĞµÑÑƒÑ€ÑĞ¸ Ğ¿Ğ¾Ñ‚Ñ€Ñ–Ğ±Ğ½Ñ– Ğ´Ğ»Ñ ĞºÑ€Ğ°Ñ„Ñ‚Ñƒ Ñ‚Ğ° Ğ¿Ğ¾Ğ»ÑŒĞ¾Ñ‚Ñ–Ğ².\n\n"
        "âš”ï¸ **Ğ’Ğ†Ğ™ĞĞ (PvP)**\n"
        "ĞĞ° ĞœĞ°Ñ€ÑÑ– Ñ‚Ğ° Ğ®Ğ¿Ñ–Ñ‚ĞµÑ€Ñ– Ğ½ĞµĞ¼Ğ°Ñ” Ğ·Ğ°ĞºĞ¾Ğ½Ñ–Ğ². Ğ’Ğ¸ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ°Ñ‚Ğ°ĞºÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ–Ğ½ÑˆÑ– ÑÑ–Ğ¼'Ñ— Ñ‚Ğ° Ğ³Ñ€Ğ°Ğ±ÑƒĞ²Ğ°Ñ‚Ğ¸ Ñ—Ñ…Ğ½Ñ– ÑĞºĞ»Ğ°Ğ´Ğ¸. Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ Ñ‚Ğ°ĞºÑ‚Ğ¸ĞºÑƒ!\n\n"
        "ğŸ›¸ **ĞĞĞ“ĞĞ  (WEB)**\n"
        "ĞĞ°Ñ‚Ğ¸ÑĞ½Ñ–Ñ‚ÑŒ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Â«ĞĞ½Ğ³Ğ°Ñ€Â», Ñ‰Ğ¾Ğ± Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ñ‚ĞµÑ€Ğ¼Ñ–Ğ½Ğ°Ğ» ĞºĞµÑ€ÑƒĞ²Ğ°Ğ½Ğ½Ñ.\n\n"
        "ğŸ›’ **ĞœĞĞ“ĞĞ—Ğ˜Ğ**\n"
        "Ğ¢ÑƒÑ‚ Ğ¼Ğ¾Ğ¶Ğ½Ğ° Ğ¿Ğ¾ĞºÑ€Ğ°Ñ‰Ğ¸Ñ‚Ğ¸ Ğ´Ğ²Ğ¸Ğ³ÑƒĞ½ (ÑˆĞ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ/Ğ°Ñ‚Ğ°ĞºĞ°) Ñ‚Ğ° ĞºĞ¾Ñ€Ğ¿ÑƒÑ (Ğ·Ğ°Ñ…Ğ¸ÑÑ‚)."
    )
    # Ğ¢ÑƒÑ‚ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ”Ğ¼Ğ¾ answer, Ğ±Ğ¾ Ñ†Ğµ Ğ´Ğ¾Ğ²Ñ–Ğ´ĞºĞ°, ÑĞºÑƒ ĞºĞ¾Ñ€Ğ¸ÑÑ‚ÑƒĞ²Ğ°Ñ‡ Ñ…Ğ¾Ñ‡Ğµ Ğ±Ğ°Ñ‡Ğ¸Ñ‚Ğ¸ Ğ¾ĞºÑ€ĞµĞ¼Ğ¾
    await message.answer(text, parse_mode="Markdown")